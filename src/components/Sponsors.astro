---
import SponsorsData from "../../public/json/sponsors.json";
import Button from "./Button.astro";
import { mail_llegada_correos_patrocinios } from "../lib/constants";

interface Sponsor {
  name: string;
  logo: string;
  url?: string;
  tier?: string;
}

interface Props {
  preview?: boolean;
}

const { preview = false } = Astro.props as Props;
const sponsors = (SponsorsData.sponsors || []) as Sponsor[];
const tiers = [
  { key: "SOCIO ESTRATEGICO", label: "SOCIO ESTRATEGICO" },
  { key: "PATROCINADOR OFICIAL", label: "PATROCINADOR OFICIAL" },
  { key: "COLABORADOR", label: "COLABORADOR" },
];
const perTierLimit = preview ? 4 : undefined;
const sponsorMailto = `mailto:${mail_llegada_correos_patrocinios}?subject=Queremos%20formar%20parte%20de%20la%20familia%20TARS%20Robotics%20UPV`;
const logoList = sponsors.map((sponsor) => ({
  name: sponsor.name,
  logo: sponsor.logo,
  url: sponsor.url,
}));
const ribbonLogos = [...logoList, ...logoList];
---

{preview ? (
  <section
    id="sponsors"
    class="px-6 sm:px-36 mt-24 flex flex-col gap-6"
  >
    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
      <div>
        <span class="inline-block text-blue-500 text-sm font-medium mb-2">
          NUESTROS ALIADOS
        </span>
        <h2 class="font-bold text-4xl text-white">Patrocinadores</h2>
      </div>
      <span class="w-fit">
        <Button
          icon="/img/money.svg"
          href="/sponsors"
          text="Conoce a nuestros patrocinadores"
        />
      </span>
    </div>

    <div class="ticker relative overflow-hidden rounded-xl border border-white/5 bg-[#0f0f0f] px-4 py-3">
      <div class="absolute left-0 top-0 h-full w-12 bg-gradient-to-r from-[#0f0f0f] to-transparent z-10"></div>
      <div class="absolute right-0 top-0 h-full w-12 bg-gradient-to-l from-[#0f0f0f] to-transparent z-10"></div>
      <div class="ticker-track">
        {
          ribbonLogos.map((sponsor, index) => {
            const Wrapper = sponsor.url ? "a" : "div";
            return (
              <Wrapper
                href={sponsor.url}
                target={sponsor.url ? "_blank" : undefined}
                rel={sponsor.url ? "noreferrer" : undefined}
                class="flex items-center justify-center px-6 py-2 opacity-70 hover:opacity-100 transition-opacity"
                aria-label={sponsor.name}
              >
                <img
                  src={sponsor.logo}
                  alt={sponsor.name}
                  class="h-10 max-w-[160px] object-contain"
                  loading="lazy"
                />
              </Wrapper>
            );
          })
        }
      </div>
    </div>
  </section>
) : (
  <section
    id="sponsors"
    class="px-6 sm:px-36 mt-24 flex flex-col gap-8"
  >
    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
      <div>
        <span class="inline-block text-blue-500 text-sm font-medium mb-2">
          NUESTROS ALIADOS
        </span>
        <h2 class="font-bold text-4xl text-white">Patrocinadores</h2>
        <p class="mt-3 text-white/70 max-w-2xl">
          Gracias a quienes impulsan nuestras ideas y proyectos. Si quieres sumarte, escribenos y hablemos.
        </p>
      </div>
      <div class="flex flex-row flex-wrap gap-3">
        <a
          href="/sponsors"
          class="inline-flex items-center gap-2 bg-white/10 hover:bg-white/20 px-4 py-2 rounded-lg text-white text-sm transition-colors"
        >
          Ver todos
          <img
            src="https://unpkg.com/pixelarticons@1.8.1/svg/arrow-right.svg"
            alt="Arrow right"
            class="w-4 h-4 invert"
          />
        </a>
        <span class="w-fit">
          <Button
            icon="/img/money.svg"
            href={sponsorMailto}
            text="Ser patrocinador"
          />
        </span>
      </div>
    </div>

    <div class="flex flex-col gap-10">
      {
        tiers.map((tier) => {
          const tierSponsors = sponsors
            .filter((sponsor) => sponsor.tier === tier.key)
            .slice(0, perTierLimit ?? sponsors.length);
          if (tierSponsors.length === 0) return null;

          return (
            <div class="flex flex-col gap-4">
              <div class="flex items-center gap-3">
                <div class="w-2 h-8 rounded-full bg-blue-500/70"></div>
                <h3 class="text-lg font-semibold text-white/80 tracking-wide">
                  {tier.label}
                </h3>
              </div>
              <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                {
                  tierSponsors.map((sponsor) => {
                    const Wrapper = sponsor.url ? "a" : "div";
                    return (
                      <Wrapper
                        href={sponsor.url}
                        target={sponsor.url ? "_blank" : undefined}
                        rel={sponsor.url ? "noreferrer" : undefined}
                        class="group relative flex items-center justify-center p-6 rounded-xl bg-[#181818] border border-zinc-800/40 hover:border-blue-500/40 transition-all hover:-translate-y-1"
                      >
                        <div class="absolute inset-0 rounded-xl bg-gradient-to-br from-blue-500/5 via-transparent to-purple-500/5 opacity-0 group-hover:opacity-100 transition-opacity" />
                        <img
                          src={sponsor.logo}
                          alt={sponsor.name}
                          class="max-h-14 max-w-[160px] object-contain grayscale group-hover:grayscale-0 transition-all"
                          loading="lazy"
                        />
                        <span class="sr-only">{sponsor.name}</span>
                      </Wrapper>
                    );
                  })
                }
              </div>
            </div>
          );
        })
      }
    </div>
  </section>
)}

{preview && (
  <style>
    .ticker-track {
      display: inline-flex;
      align-items: center;
      gap: 24px;
      animation: marquee 25s linear infinite;
      width: max-content;
    }

    .ticker:hover .ticker-track {
      animation-play-state: paused;
    }

    @keyframes marquee {
      0% {
        transform: translateX(0);
      }
      100% {
        transform: translateX(-50%);
      }
    }
  </style>
)}
